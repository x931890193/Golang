(function(){SG.User=function(){},SG.User.prototype={edit:function(t){var e=$(t).text();$(t).text("稍等").addClass("disabled").attr({title:"稍等",disabled:"disabled"});var a=$(t).parents("form"),i=a.serialize(),r=a.attr("action");$.ajax({type:"post",url:r,data:i,dataType:"json",success:function(t){t.ok?(comTip("修改成功！"),setTimeout(function(){window.location.reload()},1e3)):comTip(t.error)},complete:function(a,i){$(t).text(e).removeClass("disabled").removeAttr("disabled").attr({title:e})},error:function(a,i,r){$(t).text(e).removeClass("disabled").removeAttr("disabled").attr({title:e}),403==a.status&&comTip("没有编辑权限")}})},parseCmtContent:function(t){t.each(function(){var t=$(this).html();marked=SG.markSettingNoHightlight(),$(this).html(marked(t)),emojify.setConfig({only_crawl_id:null,img_dir:SG.EMOJI_DOMAIN,ignored_tags:{SCRIPT:1,TEXTAREA:1,A:1,PRE:1,CODE:1}}),emojify.run(this)})}},jQuery(document).ready(function(t){var e=new SG.User;e.parseCmtContent(t(".recent-comments ul li .content")),t(".submit").on("click",function(a){a.preventDefault();if(!t(this).parents(".validate-form").validate().form())return!1;e.edit(this)}),t("#active_email").on("click",function(e){return e.preventDefault(),t.ajax({type:"post",url:"/account/send_activate_email",dataType:"json",success:function(t){t.ok?comTip("激活邮件已发到您邮箱，请查收！"):comTip(t.error)},error:function(t,e,a){403==t.status&&comTip("没有操作权限")}}),!1}),t("#avatar-tab a").click(function(e){e.preventDefault(),t(this).tab("show")}),t(".btn-gravatar").on("click",function(e){e.preventDefault();var a=t(this).attr("href");t.ajax({type:"post",url:a,data:{avatar:""},dataType:"json",success:function(t){t.ok?(comTip("操作成功！"),setTimeout(function(){window.location.reload()},1e3)):comTip(t.error)},error:function(t,e,a){403==t.status&&comTip("没有操作权限")}})});var a=new plupload.Uploader({browse_button:"btn-upload-avatar",url:"/image/upload",filters:{mime_types:[{title:"图片文件",extensions:"jpg,png"}],max_file_size:"500k",prevent_duplicates:!0},multipart_params:{avatar:"1"},multi_selection:!1,file_data_name:"img",resize:{width:600}});a.init(),a.bind("FilesAdded",function(t,e){t.start()}),a.bind("UploadProgress",function(t,e){}),a.bind("FileUploaded",function(e,a,i){if(200==i.status){var r=t.parseJSON(i.response);if(r.ok){var o=r.data.uri,n=r.data.url,s=t("#img-preview").find("img");s.attr("src",n),s.attr("alt",a.name),t("#img-preview").show(),t("#upload-avatar").val(o.substr(7)),t("#upload-btn").removeAttr("disabled")}else comTip("上传失败："+r.error)}else comTip("上传失败：HTTP状态码："+i.status)}),a.bind("Error",function(t,e){comTip("上传出错了："+e.message)})})}).call(this);