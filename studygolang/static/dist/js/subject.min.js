$(function(){marked=SG.markSettingNoHightlight(),$(".desc").html(marked($(".desc").text().trim())),$(".noavatar").each(function(){var t=$(this).data("author"),a=md5(t+""),e="data:image/svg+xml;base64,"+new Identicon(a,{format:"svg",size:32}).toString();$(this).attr("src",e)});var t=$("#follow").data("follow");$("#follow").on("click",function(){var a=this;$.post("/subject/follow",{sid:$(this).data("sid")},function(e){e.ok&&(t?(t=!1,$(a).removeClass("btn-followed").addClass("btn-success"),$(a).html('<i class="fa fa-plus" aria-hidden="true"></i> 关注')):(t=!0,$(a).removeClass("btn-success").addClass("btn-followed"),$(a).html('<i class="fa fa-check" aria-hidden="true"></i> 已关注')))})}),$("#follow").on("mouseenter",function(){t&&$(this).html('<i class="fa fa-remove" aria-hidden="true"></i> 取消关注')}),$("#follow").on("mouseleave",function(){t&&$(this).html('<i class="fa fa-check" aria-hidden="true"></i> 已关注')}),$("#contribute").on("click",function(){var t=$("#follow").data("sid");$.getJSON("/subject/my_articles?sid="+t,function(t){if(t.ok){e(t.data.articles),$("body").addClass("modal-open"),$(".contribute-modal").fadeIn()}})}),$(".contribute-modal .close").on("click",function(){$("body").removeClass("modal-open"),$(".contribute-modal").fadeOut()});var a="";$(".contribute-modal .search-btn").on("click",function(){var t=$(".contribute-modal .search-input").val();if(""!=t){a=$("#contribute-note-list").html(),$("#contribute-note-list").html("");var s=$(".contribute-modal .modal-notes-placeholder");s.show();var o=$("#follow").data("sid");$.getJSON("/subject/my_articles?kw="+encodeURIComponent(t)+"&sid="+o,function(t){if(s.hide(),t.ok){var a=t.data.articles;0==a.length?$("#contribute-note-list").html('<div class="default">未找到相关文章</div>'):e(a)}else $("#contribute-note-list").html('<div class="default">'+t.msg+"</div>")})}else $("#contribute-note-list").html(a)}),$(".contribute-modal .search-input").on("change",function(){""==$(this).val()&&$("#contribute-note-list").html(a)}),$(document).keypress(function(t){10!=t.which&&13!=t.which||$(".contribute-modal .search-btn").click()}),$(".contribute-modal").on("click",".action-btn",function(){var t=$(this).parent(),a=t.data("id"),e=$("#follow").data("sid"),s=this;$(this).hasClass("push")?$.post("/subject/contribute",{sid:e,article_id:a},function(a){a.ok?(t.children(".note-name").addClass("has-add"),$(s).removeClass("push").addClass("remove").before('<span class="status has-add">已加入</span>').text("移除")):alert(a.error)}):$.post("/subject/remove_contribute",{sid:e,article_id:a},function(a){a.ok?(t.children(".note-name").removeClass("has-add"),$(s).removeClass("remove").addClass("push").text("投稿"),t.children(".status").remove()):alert(a.error)})});function e(t){var a="";for(var e in t)a+='<li><div class="article-div" data-id="'+t[e].id+'">',t[e].had_add?a+='<div class="note-name has-add">'+t[e].title+'</div><span class="status has-add">已加入</span><a class="action-btn remove">移除</a>':a+='<div class="note-name">'+t[e].title+'</div><a class="action-btn push">投稿</a>',a+="</div></li>";$("#contribute-note-list").html(a)}});